<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>聖桜高校 女子バスケ物語</title>
<style>
/* CSSの変更を反映しました */
:root{
  --accent:#87CEFA;
  --bg:#e6f3ff; /* 💡 修正点1: 目に優しい青色系の背景色（薄い水色）*/
  --text:#111;
  --maxwidth:1080px; 
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:"Hiragino Kaku Gothic Pro","Noto Sans JP",Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  line-height:1.6;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

header{
  width:100%;
  text-align:center;
  background:#fff;
  border-bottom:4px solid var(--accent);
}
header img{
    /* 💡 修正点1: ヘッダーロゴの最大高さを設定。幅は自動で調整 */
    max-width:100%;
    max-height: 120px; /* 例えば、最大高さを120pxに設定 */
    height:auto;
    display:block;
    margin:0 auto
}

.wrap{
  max-width:var(--maxwidth);
  margin:0 auto;
  padding:20px 16px;
  display:flex; 
  flex-wrap:wrap;
}

.main{
  flex:0 0 500px; 
  background:#fff;
  border-radius:8px;
  padding:20px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
}
.main h1{
  font-size:1.4rem;
  margin-bottom:14px;
  color:var(--accent);
    border-bottom: 2px dashed #eef;
    padding-bottom: 15px;
}
#news-area {
    padding: 10px;
    background-color: #f0f8ff; /* 💡 修正点2: 日記エリアの背景色も目に優しい薄い青に調整 */
    border: 1px solid #cceeff;
    border-radius: 4px;
    margin-bottom: 15px;
}

.entry{
  border-bottom:1px solid #eee;
  padding:12px 0;
}
.entry h2{
  font-size:1.1rem;
  color:#333;
  margin-bottom:6px;
}
/* 💡 修正点3: 日記本文のフォントサイズをスマホ平均（16px=1rem）に調整 */
.entry .content{
    font-size: 1rem; /* PC版より少し大きく */
    line-height: 1.8; /* 行間も広げて読みやすく */
    white-space:pre-wrap
}

.side{
  flex:1;
  min-width: 300px;
  text-align:center; /* 💡 最終修正点: 内部要素を中央寄せ */
  display: block;  /* 💡 最終修正点: Flexboxを止めて block に変更 */
  /* flex-direction, align-items, justify-content は削除 */
  padding: 20px 0;
}
.side img{
    /* 💡 修正点2: 明日香の画像をレスポンシブに。最大幅を制限しつつ、画面幅に合わせて縮小 */
    max-width: 150px; /* 元の幅を最大値として設定 */
    width: 100%; /* 親要素の幅に合わせて縮小できるようにする */
    height:auto;
    display:block;
    margin:0 auto 10px auto;
    border-radius: 8px; 
    box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
}

/* カレンダー関連のCSS */
.calendar-box { 
    width: 100%; 
    max-width: 300px; 
    margin: 0 auto 30px auto; 
    padding: 15px; 
    background: #fff; 
    border: 1px solid #ddd; 
    border-radius: 8px; 
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    border-top: 3px solid #cceeff; 
    border-bottom: 3px solid #cceeff; 
}
.calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 1.1rem; font-weight: bold; color: var(--accent); }
.calendar-header button { background: none; border: none; cursor: pointer; font-size: 1.5rem; color: var(--accent); padding: 0 5px; outline: none; }
.calendar-table { width: 100%; border-collapse: collapse; }
.calendar-table th, .calendar-table td { text-align: center; padding: 5px 0; font-size: 0.85rem; border: 1px solid #eee; }
.calendar-table th { background: #eef; color: #555; }
.has-diary { font-weight: bold; color: var(--text) !important; background: #fff9e6; cursor: pointer; }
.selected-day { background: var(--accent) !important; color: #fff !important; border: 1px solid var(--accent); box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); }
.today { 
    border: 2px solid orange !important; 
    font-weight: bold;
    background-color: #fffae6;
}
.calendar-table td:first-child { color: red; } 
.calendar-table td:last-child { color: blue; } 

footer{
  margin-top:30px;
  padding:14px;
  background:#f8f8f8;
  border-top:2px solid var(--accent);
  font-size:0.85rem;
  color:#555;
  text-align:center;
}
footer a{color:var(--accent);font-weight:600;text-decoration:none}

/* 💡 最終修正: Flexboxを止め、text-alignとmargin:autoで強制中央寄せ */
@media (max-width:900px){ 
  /* wrap (メインとサイドバーの親要素) */
  .wrap { 
      flex-direction: column; 
      align-items: center; /* メインとサイドバーのボックス自体を中央に寄せる */
  }
  
  /* side (画像とカレンダーのエリア) - 中央寄せの主因 */
  .side { 
      order: 1; 
      flex-basis: auto; 
      width: 100%; 
      
      /* 💡 修正点: min-widthを無効化し、margin: auto で中央に固定 */
      min-width: 0 !important; 
      max-width: 350px !important; 
      margin-left: auto !important; 
      margin-right: auto !important;
      
      /* Flexboxでの内部要素中央寄せは不要（.sideにtext-align:centerがあるため） */
      /* align-items: center !important; */
      /* justify-content: center !important; */
      
      padding-top: 20px;
      padding-bottom: 20px;
  }
  
  /* .calendar-box の中央寄せを確実に */
  .calendar-box {
      /* .sideにtext-align:centerがあるため、これは不要ですが、念のため残します */
      margin: 0 auto 30px auto !important;
  }
  
  /* .side img の中央寄せを確実に（display: block; + margin: auto;で既にOK） */
  .side img {
      margin: 30px auto 10px auto !important;
  }

  /* main (日記本文エリア) */
  .main { 
      order: 2; 
      flex-basis: auto; 
      width: 100%; 
      max-width: 600px; 
      margin-top: 20px;
  }
}
</style>
</head>
<body>
<header>
        <img src="seiodanmaku.png" width="150" height="150" alt="聖桜高校 女子バスケ物語 ロゴ" />
</header>

<div class="wrap">
    <main class="main">
        
        <div id="hitokoto-area" style="font-size: 1.1rem; font-weight: bold; color: #555; background-color: #f0f8ff; padding: 10px; border-radius: 5px; margin-bottom: 20px;">
            ようこそ！今日も一日、バスケも勉強も頑張りましょう！
        </div>

        <h1>今日の明日香の日記</h1>
    <div id="news-area">読み込み中です…</div>
        <p style="margin-top: 15px;"><a href="past.html">過去の日記を見る</a></p>
  </main>
  
  <aside class="side">
            
    <div id="calendar-area" class="calendar-box">
      <p style="margin-top: 20px; font-weight: bold;">日付をクリックして日記を読み込めます</p>
    </div>
    
    <img src="asukasakurai.jpg" alt="桜井明日香" style="margin-top: 30px;" />
    <div style="font-size: 0.9rem; color: #555;">聖桜高校 女子バスケ部エース</div>

  </aside>
</div>
<script>
// =======================================================
// JSONデータとカレンダー表示のロジック (堅牢化)
// =======================================================

// 💡 グローバル変数をすべてここで初期化
let diaryData = []; 
let diaryMap = new Map(); 
let currentDate = new Date(); 
const maxFutureDate = new Date();
maxFutureDate.setFullYear(maxFutureDate.getFullYear() + 5);

// -------------------------------------------------------
// Helper Functions
// -------------------------------------------------------

function formatDate(date) {
    const yyyy = date.getFullYear();
    const mm = String(date.getMonth() + 1).padStart(2, '0');
    const dd = String(date.getDate()).padStart(2, '0');
    return `${yyyy}-${mm}-${dd}`;
}

function updateSelectedDay(dateKey) {
    document.querySelectorAll('.calendar-table td').forEach(td => { td.classList.remove('selected-day'); });
    const selectedTd = document.querySelector(`td[data-date="${dateKey}"]`);
    if (selectedTd) { selectedTd.classList.add('selected-day'); }
}

function displayDiaryEntry(date) { 
    const entry = diaryMap.get(date);
    const area = document.getElementById("news-area");
    // 日記タイトルを更新
    document.querySelector('.main h1').textContent = `${date}の明日香の日記`; 

    if (entry) {
        // 💡 明日香の一人称が「ボク」であることを意識した応答（CSS修正のため内容はそのまま）
        area.innerHTML = `<article class="entry"><h2>${entry.title}  (ボクの日記)</h2><div class="content">${entry.body || "本文なし"}</div></article>`;
    } else {
        area.innerHTML = `<article class="entry"><h2>${date} の日記</h2><div class="content">この日の日記はまだありません。</div></article>`;
    }
    updateSelectedDay(date);
}

function createDayCell(year, month, day, currentDayKey) {
    const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    let className = '';
    if (dateKey === currentDayKey) { className += ' today'; }
    if (diaryMap.has(dateKey)) { className += ' has-diary'; }
    return `<td class="${className}" data-date="${dateKey}" onclick="handleDayClick('${dateKey}')">${day}</td>`;
}

function renderCalendar(year, month) {
    const calendarArea = document.getElementById('calendar-area');
    const firstDayOfMonth = new Date(year, month, 1).getDay(); 
    const daysInMonth = new Date(year, month + 1, 0).getDate(); 
    const today = new Date();
    const currentDayKey = formatDate(today);
    
    // 月を進めるボタンの表示判定
    const nextMonth = new Date(year, month + 1, 1);
    let nextButton = `<button onclick="changeMonth(1)">&#9654;</button>`;
    if (nextMonth > maxFutureDate) {
        nextButton = `<button style="opacity: 0.3; cursor: default;">&#9654;</button>`;
    }

    let html = '';
    html += '<div class="calendar-header">';
    html += `<button onclick="changeMonth(-1)">&#9664;</button>`; 
    html += `<span>${year}年 ${month + 1}月</span>`;
    html += nextButton;
    html += '</div>';

    html += '<table class="calendar-table">';
    html += '<thead><tr><th>日</th><th>月</th><th>火</th><th>水</th><th>木</th><th>金</th><th>土</th></tr></thead>';
    html += '<tbody><tr>';

    let day = 1;
    let i; 

    for (i = 0; i < firstDayOfMonth; i++) {
        html += '<td></td>';
    }

    for (; i < 7; i++) {
        if (day <= daysInMonth) {
            html += createDayCell(year, month, day++, currentDayKey);
        } else {
            html += '<td></td>';
        }
    }
    html += '</tr>';

    while (day <= daysInMonth) {
        html += '<tr>';
        for (i = 0; i < 7 && day <= daysInMonth; i++) {
            html += createDayCell(year, month, day++, currentDayKey);
        }
        if (day > daysInMonth) {
            for (; i < 7; i++) {
                html += '<td></td>';
            }
        }
        html += '</tr>';
    }
    
    html += '</tbody></table>';
    
    const wrapper = document.createElement('div');
    wrapper.innerHTML = html;
    calendarArea.innerHTML = '';
    calendarArea.appendChild(wrapper);

    if (diaryData.length > 0) {
        updateSelectedDay(diaryData[0].date);
    }
}

function changeMonth(delta) { 
    const nextDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + delta, 1);
    
    // 5年先の月を超えないように制限
    if (delta > 0 && nextDate > maxFutureDate) {
        return; 
    }
    
    currentDate.setMonth(currentDate.getMonth() + delta); 
    renderCalendar(currentDate.getFullYear(), currentDate.getMonth()); 
}
function handleDayClick(dateKey) { 
    displayDiaryEntry(dateKey); 
}

// -------------------------------------------------------
// Initial Load (初期ロード処理)
// -------------------------------------------------------
fetch("diary.json") 
    .then(response => {
        if (!response.ok) {
            // エラー時もレンダリングは継続させる
            throw new Error('JSONファイルを読み込めませんでした。ステータス: ' + response.status);
        }
        return response.json(); 
    })
    .then(data => {
        diaryData = data;
        diaryData.forEach(entry => {
            diaryMap.set(entry.date, entry);
        });

        // JSONが空でない限り、最新の日記を表示
        if (diaryData.length > 0) {
            displayDiaryEntry(diaryData[0].date);
        } else {
            document.getElementById("news-area").innerHTML = `<article class="entry"><h2>日記データがありません。</h2><div class="content">日記ファイル(diary.json)にデータが記述されていません。</div></article>`;
        }

        renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
    })
    .catch(err => {
        const area = document.getElementById("news-area");
        // JSON読み込み失敗時のメッセージ
        area.innerHTML = `<p style="color: red; font-weight: bold;">日記データファイル(diary.json)の読み込みに失敗しました。ファイル名と形式を確認してください。</p>`;
        console.error("JSONデータの読み込みまたは解析に失敗:", err);
        // エラー時もカレンダーだけは表示
        renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
    });
</script>

<footer>
  <p>© 2025 聖桜高校 女子バスケ物語 Project. 運営: 三鷹夢新聞</p>
  <p style="margin-top: 5px; font-size: 0.8rem;">※このサイトはゲーム制作のため、架空の団体・人物を含みます。</p>
</footer>

</body> 
</html>