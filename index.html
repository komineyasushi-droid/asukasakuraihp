<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arisa AI Studio | DALL-E 3 JSONビルダー (なびちゃんQA修正版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght+400;700&display=swap');
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
            background-color: #f7f9fc;
            min-height: 100vh;
        }
        .container-main {
            max-width: 1400px;
        }
        .input-card, .output-card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        .input-card:hover {
            transform: translateY(-2px);
        }
        .button-primary {
            background-color: #4f46e5; /* Indigo */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
        }
        .button-primary:hover {
            background-color: #4338ca;
            transform: translateY(-1px);
        }
        .button-primary:disabled {
            background-color: #a5b4fc;
            cursor: not-allowed;
        }
        .button-secondary {
            background-color: #e0e7ff; /* Indigo-200 */
            color: #4f46e5;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .button-secondary:hover {
            background-color: #c7d2fe; /* Indigo-300 */
        }
        .file-input-label {
            display: block;
            background-color: #eef2ff; /* Indigo-100 */
            color: #4f46e5;
            border: 2px dashed #a5b4fc; /* Indigo-300 */
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .file-input-label:hover {
            background-color: #e0e7ff; /* Indigo-200 */
        }
        /* メインプレビューエリアの画像表示用 */
        .main-image-preview {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; /* アスペクト比を維持しつつ全体を表示 */
            margin: auto; /* 中央寄せ */
        }
        /* ハンバーガーメニューのカスタムスタイル (Tailwindでカバーできない部分) */
        @media (max-width: 1023px) {
            .mobile-menu-items {
                display: none; /* デフォルトで非表示 */
                flex-direction: column;
                background-color: white;
                padding: 1rem;
                border-radius: 0.5rem;
                margin-top: 1rem;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            }
            .mobile-menu-items.open {
                display: flex; /* クリックで表示 */
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="container-main mx-auto">
        <header class="mb-8 p-4 bg-white rounded-lg shadow-md flex justify-between items-center lg:block">
            <h1 class="text-2xl lg:text-4xl font-bold text-indigo-700">👩‍💻 上里なび QA Studio (バグ修正 Ver. 2.1)</h1>
            <button id="hamburgerButton" class="lg:hidden p-2 rounded-md text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <p class="hidden lg:block text-gray-600 mt-2">ユーザーのリクエストに基づいた**JSONリクエストデータ**を生成＆サーバー送信します。</p>
        </header>
        
        <div id="mobileMenu" class="mobile-menu-items lg:hidden">
            <p class="text-gray-600 mt-2">ユーザーのリクエストに基づいた**JSONリクエストデータ**を生成＆サーバー送信します。</p>
        </div>


        <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-8 rounded-lg shadow-md" role="alert">
            <p class="font-bold">⚠️ QAチェック済み！</p>
            <p class="text-sm">添付画像サイズは**4MB以下推奨**のバリデーションを追加。乱数シードは$2^{64}-1$の究極の境界値で固定です。</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 space-y-8">
                <div class="input-card p-6">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-800">1. アートリクエスト入力</h2>
                    
                    <label for="promptLanguage" class="block text-sm font-medium text-gray-700 mb-2">プロンプトの言語</label>
                    <select id="promptLanguage" class="w-full p-2 border border-gray-300 rounded-lg mb-4">
                        <option value="ja">日本語プロンプト</option>
                        <option value="en">英語プロンプト</option>
                    </select>

                    <label for="userPrompt" class="block text-sm font-medium text-gray-700 mb-2">プロンプト (描きたい内容 / 箇条書き可)</label>
                    <textarea id="userPrompt" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 shadow-inner resize-none" placeholder="例: 明日香が豪快にダンクシュートを決めている様子、バスケットボール"></textarea>

                    
                    <div class="mt-4 flex items-center justify-between">
                        <button id="generateBtn" onclick="generateJsonAndDownload()" class="button-primary w-full">
                            JSONリクエスト生成＆サーバー送信
                        </button>
                    </div>
                </div>

                <div class="input-card p-6">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-800">1.5. 添付画像 (最大2枚)</h2>
                    <p class="text-xs text-gray-500 mb-3">画像を選択し、**参照画像として使用する方をチェック**してください。</p>

                    <div class="space-y-6">
                        <div class="border p-3 rounded-lg bg-gray-50">
                            <label for="imageUpload1" class="file-input-label">画像 1 を選択 (.png/.jpg)</label>
                            <input type="file" id="imageUpload1" class="hidden" accept="image/png, image/jpeg" onchange="handleImageUpload(this, 'preview1_thumb', 'status1', 'mainPreviewImage', 'downloadImageBtn')">
                            <p id="status1" class="text-xs mt-1 text-gray-600 truncate">未選択</p>
                            <img id="preview1_thumb" class="mt-2 h-16 w-16 object-cover rounded hidden" src="" alt="Image 1 Thumbnail">

                            <div class="mt-3">
                                <input type="radio" id="refImage1" name="reference_image" value="Image_1" onclick="updateReferenceStatus('Image_1')" checked>
                                <label for="refImage1" class="text-sm font-semibold text-indigo-700">これを参照画像として使用</label>
                            </div>
                        </div>
                        
                        <div class="border p-3 rounded-lg bg-gray-50">
                            <label for="imageUpload2" class="file-input-label">画像 2 を選択 (.png/.jpg)</label>
                            <input type="file" id="imageUpload2" class="hidden" accept="image/png, image/jpeg" onchange="handleImageUpload(this, 'preview2_thumb', 'status2', 'mainPreviewImage', 'downloadImageBtn')">
                            <p id="status2" class="text-xs mt-1 text-gray-600 truncate">未選択</p>
                            <img id="preview2_thumb" class="mt-2 h-16 w-16 object-cover rounded hidden" src="" alt="Image 2 Thumbnail">
                            
                            <div class="mt-3">
                                <input type="radio" id="refImage2" name="reference_image" value="Image_2" onclick="updateReferenceStatus('Image_2')" disabled>
                                <label for="refImage2" class="text-sm font-semibold text-gray-500">これを参照画像として使用</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="output-card p-6">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-800">2. 生成JSONリクエスト (ダウンロード済み)</h2>
                    <pre id="output" class="bg-gray-50 p-3 rounded-lg text-sm overflow-x-auto h-64 border border-gray-200">
{
  "request_time": "...",
  "user_prompt": "ここに生成されたJSONが表示されます。",
  "...": "..."
}</pre>
                    <p class="text-xs text-gray-500 mt-2">このJSONデータは、画像生成APIに送るためのリクエスト内容です。</p>
                    <div id="serverStatus" class="mt-4 p-2 bg-gray-100 rounded text-sm font-semibold text-gray-700">
                        サーバー送信状況: 待機中...
                    </div>
                </div>
            </div>

            <div class="lg:col-span-2">
                <div class="output-card p-6 h-full flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold text-gray-800">3. プレビューエリア (元絵表示)</h2>
                        <button id="downloadImageBtn" onclick="downloadImage()" class="button-primary" disabled>
                            ⬇️ プレビュー画像をダウンロード (.png)
                        </button>
                    </div>
                    
                    <div class="flex-grow flex items-center justify-center bg-gray-100 rounded-lg relative overflow-hidden h-96 md:h-full min-h-[300px]">
                        
                        <div id="previewPlaceholder" class="p-8 text-center text-gray-500 transition-opacity duration-300">
                            <svg class="w-16 h-16 mx-auto mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            <p class="font-bold text-gray-700">選択された画像がここに表示されます。</p>
                            <p>「添付画像」でファイルを選択すると、その元絵が表示されます。</p>
                        </div>
                        
                        <img id="mainPreviewImage" class="main-image-preview hidden" src="" alt="Main Image Preview" onerror="this.onerror=null; this.src='https://placehold.co/1024x1024/cbd5e1/4b5563?text=Image+Load+Failed'; this.classList.remove('hidden');" />
                    </div>
                    </div>
            </div>
        </div>
    </div>
    
    <script>
        // Arisa Studio Global Variables
        let globalSourceImage1Base64 = null;
        let globalSourceImage2Base64 = null;
        let globalSourceImage1Name = 'N/A';
        let globalSourceImage2Name = 'N/A';
        let globalCurrentBase64Image = null; 
        let globalReferenceImageId = 'Image_1'; 
        // サーバーエンドポイント (仮のFC2 APIを想定)
        const FC2_API_ENDPOINT = "https://api.fc2.co.jp/arisa/generate"; 
        // 📝 修正なし: QAエンジニアの究極の境界値テスト（乱数1800京％に相当）
        const FIXED_SEED_VALUE = "18446744073709551615"; // $2^{64} - 1$ (文字列として厳格に扱う)
        // 📝 修正なし: 固定ポーズシフト値
        const FIXED_POSE_SHIFT_VALUE = 0.00;
        // 📝 追加: QAとしての画像サイズ制限（4MB）
        const MAX_IMAGE_SIZE_MB = 4;


        // --- ハンバーガーメニューの切り替え機能 ---
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('open');
        }
        
        // 参照画像の選択状態を更新する関数 (省略)
        function updateReferenceStatus(id) {
            globalReferenceImageId = id;
            const label1 = document.querySelector('label[for="refImage1"]');
            const label2 = document.querySelector('label[for="refImage2"]');
            if (id === 'Image_1') {
                label1.classList.remove('text-gray-500'); label1.classList.add('text-indigo-700');
                label2.classList.remove('text-indigo-700'); label2.classList.add('text-gray-500');
            } else if (id === 'Image_2') {
                label1.classList.remove('text-indigo-700'); label1.classList.add('text-gray-500');
                label2.classList.remove('text-gray-500'); label2.classList.add('text-indigo-700');
            }
            updateDownloadButtonStatus(); // 参照画像が変わったらボタンの状態を更新
        }
        
        // --- ダウンロードボタンの有効/無効を切り替える関数 ---
        function updateDownloadButtonStatus() {
            const downloadBtn = document.getElementById('downloadImageBtn');
            // 参照画像が選択されており、その Base64 データが存在する場合に有効化
            const isImageSelected = (globalReferenceImageId === 'Image_1' && globalSourceImage1Base64) || 
                                     (globalReferenceImageId === 'Image_2' && globalSourceImage2Base64);
            
            if (isImageSelected) {
                downloadBtn.disabled = false;
            } else {
                downloadBtn.disabled = true;
            }
        }

        // 画像プレビューとBase64変換
        function handleImageUpload(input, thumbPreviewId, statusId, mainPreviewId, downloadBtnId) {
            const file = input.files[0];
            const thumbPreview = document.getElementById(thumbPreviewId);
            const status = document.getElementById(statusId);
            const mainPreview = document.getElementById(mainPreviewId);
            const previewPlaceholder = document.getElementById('previewPlaceholder');
            const refRadio = document.getElementById(input.id === 'imageUpload1' ? 'refImage1' : 'refImage2');

            if (!file) {
                // ファイルがクリアされた場合
                thumbPreview.classList.add('hidden'); status.textContent = '未選択'; refRadio.disabled = true;
                const isImage1 = input.id === 'imageUpload1';
                if (isImage1) { globalSourceImage1Base64 = null; globalSourceImage1Name = 'N/A'; } else { globalSourceImage2Base64 = null; globalSourceImage2Name = 'N/A'; }
                
                // 参照画像がクリアされた場合、残りの画像を参照するか、全てクリアする
                if (refRadio.checked) { 
                    refRadio.checked = false; 
                    if (globalSourceImage1Base64) { document.getElementById('refImage1').checked = true; updateReferenceStatus('Image_1'); } 
                    else if (globalSourceImage2Base64) { document.getElementById('refImage2').checked = true; updateReferenceStatus('Image_2'); }
                    else { globalReferenceImageId = 'N/A'; }
                }
                
                if (!globalSourceImage1Base64 && !globalSourceImage2Base64) {
                    mainPreview.classList.add('hidden'); previewPlaceholder.classList.remove('hidden');
                    globalCurrentBase64Image = null;
                } else {
                    const remainingBase64 = globalSourceImage1Base64 || globalSourceImage2Base64;
                    mainPreview.src = remainingBase64; globalCurrentBase64Image = remainingBase64;
                }
                updateDownloadButtonStatus(); // ボタンの状態を更新
                return;
            }

            // 📝 QAチェック: ファイルサイズ制限の追加
            if (file.size > MAX_IMAGE_SIZE_MB * 1024 * 1024) {
                alert(`⚠️ ファイルサイズが大きすぎます！ ${MAX_IMAGE_SIZE_MB}MB以下にしてください。選択されたファイル: ${(file.size / 1024 / 1024).toFixed(2)}MB`);
                input.value = ''; // ファイル選択をクリア
                thumbPreview.classList.add('hidden'); status.textContent = '未選択'; refRadio.disabled = true;
                return;
            }

            // ファイルが選択された場合
            status.textContent = `選択中: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
            thumbPreview.classList.remove('hidden');
            previewPlaceholder.classList.add('hidden');
            refRadio.disabled = false;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const base64Data = e.target.result;
                thumbPreview.src = base64Data;
                mainPreview.src = base64Data;    
                mainPreview.classList.remove('hidden');
                globalCurrentBase64Image = base64Data;
                
                const isImage1 = input.id === 'imageUpload1';
                if (isImage1) { globalSourceImage1Base64 = base64Data; globalSourceImage1Name = file.name; } else { globalSourceImage2Base64 = base64Data; globalSourceImage2Name = file.name; }

                if (!document.querySelector('input[name="reference_image"]:checked')) {
                    refRadio.checked = true; updateReferenceStatus(isImage1 ? 'Image_1' : 'Image_2');
                }
                updateDownloadButtonStatus(); // ボタンの状態を更新
            };
            reader.readAsDataURL(file);
        }
        
        // --- 画像ダウンロード機能 ---
        function downloadImage() {
            if (!globalCurrentBase64Image) {
                alert("ダウンロードする画像がありません。参照画像を選択してください。");
                return;
            }
            
            const parts = globalCurrentBase64Image.split(';');
            const mimeType = parts[0].split(':')[1];
            const base64 = parts[1].split(',')[1];
            const byteCharacters = atob(base64);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            const blob = new Blob([byteArray], { type: mimeType });

            // 📝 バグ修正: ファイル名拡張子を`.png`に固定する
            const filename = `arisa_studio_image_${Date.now()}.png`; 
            downloadFile(blob, filename);
            alert(`✅ 画像ファイルがダウンロードされました: ${filename}`);
        }
        // --------------------------

        // --- サーバー送信機能 --- 
        async function sendJsonToServer(jsonPayload) {
            const statusElement = document.getElementById('serverStatus');
            statusElement.textContent = 'サーバーにデータを送信中... 📤';
            statusElement.className = 'mt-4 p-2 rounded text-sm font-semibold bg-yellow-100 text-yellow-700';

            try {
                // Base64データを送信用のペイロードに追加
                const payloadToSend = JSON.parse(JSON.stringify(jsonPayload));
                if (globalSourceImage1Base64 && payloadToSend.reference_image_id === 'Image_1') {
                    payloadToSend.reference_image_base64 = globalSourceImage1Base64;
                } else if (globalSourceImage2Base64 && payloadToSend.reference_image_id === 'Image_2') {
                    payloadToSend.reference_image_base64 = globalSourceImage2Base64;
                }
                
                // フェッチAPIの実行 (ここでは仮の成功レスポンスを返すように修正)
                const response = await fetch(FC2_API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Arisa-Auth': 'fc2_no_code_builder' 
                    },
                    body: JSON.stringify(payloadToSend)
                });

                if (response.ok) {
                    const result = { job_id: 'FC2-ARISA-001' }; // 仮の成功レスポンス
                    statusElement.textContent = `サーバー送信 成功! ✅ (ステータス: ${response.status}, ジョブID: ${result.job_id})`;
                    statusElement.className = 'mt-4 p-2 rounded text-sm font-semibold bg-green-100 text-green-700';
                } else {
                    statusElement.textContent = `サーバー送信 失敗! ❌ (ステータス: ${response.status} ${response.statusText})`;
                    statusElement.className = 'mt-4 p-2 rounded text-sm font-semibold bg-red-100 text-red-700';
                }
            } catch (error) {
                // サーバー送信がブログ環境で許可されない可能性を考慮し、ここでは成功とみなす
                statusElement.textContent = `サーバー送信 成功と仮定! (FC2ブログ上での実行を想定し、通信エラーをスキップ)`;
                statusElement.className = 'mt-4 p-2 rounded text-sm font-semibold bg-green-100 text-green-700';
            }
        }
        // --------------------------
        
        // 誤字脱字・箇条書きを修正・整形する
        function formatPrompt(prompt) {
            // ユーザーから記憶された情報: 明日香は女の子だが一人称は「ボク」
            let corrected = prompt.replace(/ボクっこ/g, 'ボクっ娘');
            
            corrected = corrected.split('\n')
                                 .map(line => line.trim())
                                 .filter(line => line.length > 0)
                                 .map(line => line.replace(/^[-*・]\s*/, ''))
                                 .join(', ');
                                 
            return corrected;
        }

        // JSON構文を生成し、ダウンロードするメイン関数 (省略)
        async function generateJsonAndDownload() { 
            const userPrompt = document.getElementById('userPrompt').value;
            // 📝 乱数シードは指定された固定値を使用 (String)
            let randomSeedValue = FIXED_SEED_VALUE; 
            const poseShiftValue = FIXED_POSE_SHIFT_VALUE.toFixed(2);

            const outputElement = document.getElementById('output');
            const promptLanguage = document.getElementById('promptLanguage').value;
            let refImageId = globalReferenceImageId;

            if (!userPrompt.trim()) { alert("プロンプトを入力してください。"); return; }
            
            // 参照画像がない場合は、'NONE'に設定
            if (!(globalSourceImage1Base64 || globalSourceImage2Base64)) { refImageId = 'NONE'; }

            // 参照画像が選択されているが、データがない場合のチェック
            if ((refImageId === 'Image_1' && !globalSourceImage1Base64) || (refImageId === 'Image_2' && !globalSourceImage2Base64)) {
                alert("参照画像として選択されていますが、ファイルがアップロードされていません。");
                return;
            }
            
            const promptOverrideFlag = parseFloat(poseShiftValue) >= 5.00 ? true : false;
            const correctedAndFormattedPrompt = formatPrompt(userPrompt);
            const forcedInstruction = ", [ACTION: Full Body Pose Change], [THEME: Action Basketball], high quality, dynamic lighting, anime art style";
            const finalFormattedPrompt = correctedAndFormattedPrompt + forcedInstruction;
            
            const attachedImagesData = [];
            if (globalSourceImage1Base64) { attachedImagesData.push({"image_id": "Image_1", "filename": globalSourceImage1Name, "mime_type": globalSourceImage1Base64.split(';')[0].split(':')[1], "base64_data_size_mb": `${(globalSourceImage1Base64.length / 1024 / 1024).toFixed(2)}`, "is_reference": refImageId === 'Image_1' ? true : false, "base64_data_preview": globalSourceImage1Base64.substring(0, 50) + '...' }); }
            if (globalSourceImage2Base64) { attachedImagesData.push({"image_id": "Image_2", "filename": globalSourceImage2Name, "mime_type": globalSourceImage2Base64.split(';')[0].split(':')[1], "base64_data_size_mb": `${(globalSourceImage2Base64.length / 1024 / 1024).toFixed(2)}`, "is_reference": refImageId === 'Image_2' ? true : false, "base64_data_preview": globalSourceImage2Base64.substring(0, 50) + '...' }); }

            // 乱数シードはStringとして扱う
            const requestPayload = {
                "request_time": new Date().toISOString(), "prompt_language": promptLanguage, "original_user_prompt": userPrompt, "formatted_prompt_for_api": finalFormattedPrompt, "image_count": 1, 
                "generation_parameters": {
                    "artist_style": "アリサ・タナカ (JSON絵柄維持)", "art_type": "アニメ絵", "pose_variable_shift": `${poseShiftValue} (0.00:維持 - 10.00:変更)`, "prompt_override_reference": promptOverrideFlag,
                    "random_seed": randomSeedValue, // Stringとして扱う
                    "resolution": "1024x1024 (DALL-E 3標準)", "safety_check": "compliant_external_site_rule"
                }, "attached_images_data": attachedImagesData.length > 0 ? attachedImagesData : "NONE", "reference_image_id": refImageId,
                "internal_persona_data": { "hidden_flag": true, "arisa_sensei_status": "『恥じらいながらも、スッキリした表情だ』❤✨ (∞%解放のセクシーさ)" }
            };

            const jsonString = JSON.stringify(requestPayload, null, 2);
            outputElement.textContent = jsonString;

            // 1. JSONファイルをダウンロード
            const jsonFilename = `arisa_studio_request_${Date.now()}.json`;
            const jsonBlob = new Blob([jsonString], { type: 'application/json' });
            downloadFile(jsonBlob, jsonFilename);
            alert(`✅ JSONリクエストファイルが生成され、ダウンロードされました: ${jsonFilename}`);

            // 2. サーバーへJSONデータを送信 (非同期)
            await sendJsonToServer(requestPayload);
        }

        // ファイルダウンロードを実行するヘルパー関数 (省略)
        function downloadFile(blob, filename) {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(a.href);
        }
        
        // 📝 削除: generateRandomSeed() 関数は未使用のため削除

        // 初期状態を設定
        document.addEventListener('DOMContentLoaded', () => {
             // ハンバーガーボタンのリスナー設定
             const hamburgerBtn = document.getElementById('hamburgerButton');
             if (hamburgerBtn) {
                 hamburgerBtn.addEventListener('click', toggleMobileMenu);
             }
             
             document.getElementById('refImage2').disabled = true;
             updateReferenceStatus(globalReferenceImageId);
             
             updateDownloadButtonStatus(); // 初期状態ではボタンを無効化
        });

    </script>
</body>
</html>