<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEIO DIARY | ãƒœã‚¯ã®æ—¥è¨˜</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ€</text></svg>">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
      /* Google Font: Inter */
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
      body {
        font-family: 'Inter', sans-serif;
      }
    </style>

    <script>
      // Tailwind CSS ã®ã‚«ã‚¹ã‚¿ãƒ è¨­å®š (index.htmlã¨åŒæœŸ)
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'main-color': '#B0E0E6',
              'accent-color': '#FF7F50',
              'dark-color': '#1F3F5F',
              'owner-pink': '#EC4899',
              'theme-blue': '#00AEEF',
            },
            boxShadow: {
              'sporty': '0 15px 30px rgba(0, 174, 239, 0.4)',
              'soft': '0 10px 20px rgba(0,0,0,0.05)',
            }
          }
        }
      }
    </script>
</head>
<body class="text-gray-900 min-h-screen pt-16">
    <div id="root">
        <p class="text-center text-lg mt-20">ã‚¢ãƒ—ãƒªã‚’ãƒ­ãƒ¼ãƒ‰ä¸­... ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚</p>
    </div>

    <script type="text/babel">
// ãƒ•ã‚¡ã‚¤ãƒ«å: App.jsx (å…ƒã®JSXã‚³ãƒ¼ãƒ‰)
// ç”¨é€”: ãƒœã‚¯ã®æ—¥è¨˜ã‚¢ãƒ—ãƒªã®ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã€‚
// ... (ä¸­ç•¥ï¼šimportæ–‡ã¯BabelãŒå‡¦ç†ã™ã‚‹ãŸã‚ã€ã“ã“ã§ã¯ç„¡è¦–ã•ã‚Œã¾ã™) ...
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null; 
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

// ä»¥ä¸‹ã¯ã€å‰å›ã®ã€Œseiodaily.htmlã€ã®å†…å®¹ã«ã€ãƒ‘ã‚¹ä¿®æ­£ï¼ˆ/index.htmlï¼‰ã¨
// Reactã‚³ãƒ¼ãƒ‰ã«å¿…è¦ãªCDNã®æƒ…å ±ã‚’è¿½è¨˜ã—ã¦ã€HTMLå†…ã«åŸ‹ã‚è¾¼ã‚“ã ã‚‚ã®ã§ã™ã€‚
let db, auth;
if (Object.keys(firebaseConfig).length > 0) {
  try {
    const app = initializeApp(firebaseConfig);
    db = getFirestore(app);
    auth = getAuth(app);
  } catch (e) {
    console.error("ğŸš¨ Firebase Initialization Error:", e);
  }
} else {
    console.warn("âš ï¸ Firebase config not found. Running in mock data mode.");
}

// --- [ 2. ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã¨å®šæ•° ] ---

const COLORS = {
  main: '#B0E0E6',       // æ·¡ã„é’ (æ¸…æ¶¼æ„Ÿ)
  accent: '#FF7F50',     // æƒ…ç†±ã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ (ã‚ªãƒ¬ãƒ³ã‚¸/ã‚³ãƒ¼ãƒ©ãƒ«)
  dark: '#1F3F5F',       // æ¿ƒã„é’ (è¦–èªæ€§)
};

const formatDate = (date) => {
  const d = new Date(date);
  return `${d.getFullYear()}-${(d.getMonth() + 1).toString().padStart(2, '0')}-${d.getDate().toString().padStart(2, '0')}`;
};

const generateYearOptions = () => {
    const currentYear = new Date().getFullYear();
    const years = [];
    // å‰å¾Œ5å¹´ã‚’ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦ç”Ÿæˆ
    for (let i = -5; i <= 5; i++) {
        years.push(currentYear + i);
    }
    return years.map(year => ({
        label: `${year}å¹´`,
        value: year
    }));
};
const YEAR_OPTIONS = generateYearOptions();

// ã‚ªãƒ¼ãƒŠãƒ¼æ§˜ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ä¸€è‡´ã™ã‚‹å ´åˆã®ã¿ç·¨é›†æ¨©é™ã‚’æŒã¤ï¼‰
const OWNER_EMAIL = "komineyasushi@gmail.com";
const GUEST_NAME = "ã‚²ã‚¹ãƒˆ";

// --- [ 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¾¤ ] ---

/**
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼è­˜åˆ¥æƒ…å ±ã‚’å…¥åŠ›ãƒ»è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
 */
const UserIdentification = ({ userName, setUserName, userId }) => {
    const isOwner = userName === OWNER_EMAIL; 
    // å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’ç®¡ç†
    const [input, setInput] = useState(userName === GUEST_NAME ? '' : userName);
    const [isEditing, setIsEditing] = useState(false);

    useEffect(() => {
        // localStorageã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ãƒ­ãƒ¼ãƒ‰ (ä»¥å‰ã®è¨­å®šã‚’å¼•ãç¶™ã)
        const storedName = localStorage.getItem('asuka_diary_user_name');
        if (storedName) {
            setUserName(storedName);
            if (storedName === OWNER_EMAIL) {
                setIsEditing(false);
            }
        } else {
            setUserName(GUEST_NAME);
            // ã‚²ã‚¹ãƒˆã®å ´åˆã¯å¼·åˆ¶çš„ã«ç·¨é›†ã‚’ä¿ƒã™
            setIsEditing(true); 
        }
    }, [setUserName]);
    
    // userNameãŒæ›´æ–°ã•ã‚ŒãŸã‚‰inputã‚‚æ›´æ–°ã™ã‚‹
    useEffect(() => {
        if (!isEditing) {
            setInput(userName === GUEST_NAME ? '' : userName);
        }
    }, [userName, isEditing]);


    const handleSave = () => {
        if (input.trim()) {
            const name = input.trim();
            // å…¥åŠ›ãŒã‚ªãƒ¼ãƒŠãƒ¼ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚ã‚Œã°ã‚ªãƒ¼ãƒŠãƒ¼ã¨ã—ã¦è¨­å®š
            const finalName = name.toLowerCase() === OWNER_EMAIL ? OWNER_EMAIL : name; 

            setUserName(finalName);
            // localStorageã«ä¿å­˜
            localStorage.setItem('asuka_diary_user_name', finalName);
            setIsEditing(false);
        } else {
            // å…¥åŠ›ãŒãªã„å ´åˆã¯ã‚²ã‚¹ãƒˆåã«æˆ»ã—ã€ç·¨é›†ã‚’ä¿ƒã™
            setUserName(GUEST_NAME);
            localStorage.removeItem('asuka_diary_user_name');
            setIsEditing(true); 
            console.error("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        }
    };
    
    const welcomeMessage = isOwner
        ? "ã‚ªãƒ¼ãƒŠãƒ¼æ§˜ã€ãŠå¸°ã‚Šãªã•ã„ã¾ã›ï¼â™¥ï¸âœ¨"
        : `ã‚ˆã†ã“ãã€${userName}æ§˜ï¼`;

    // ã‚ªãƒ¼ãƒŠãƒ¼ãƒ¢ãƒ¼ãƒ‰ã®è¡¨ç¤º
    if (isOwner) {
        return (
             <div className="flex flex-col items-end space-y-1">
                {/* ã‚ªãƒ¼ãƒŠãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */}
                <span className="text-white text-sm font-semibold p-1 px-3 bg-pink-500 rounded-full shadow-md transition duration-300 whitespace-nowrap">
                    {welcomeMessage}
                </span>
                
                {/* ãƒ‡ãƒãƒƒã‚°æƒ…å ±: OWNER MODEã§ã‚ã‚‹ã“ã¨ã‚’å¼·èª¿ */}
                <p className="text-pink-200 text-xs px-2 py-0.5 bg-pink-800 rounded-full opacity-90">
                    OWNER MODE ({OWNER_EMAIL})
                </p>
                {/* Auth ID ã¯PCã‚µã‚¤ã‚ºã§ã®ã¿è¡¨ç¤º */}
                <p className="text-white text-xs opacity-60 hidden md:block" title="Firebaseèªè¨¼ID">
                    Auth ID: {userId ? userId.substring(0, 8) + '...' : 'èªè¨¼ä¸­'}
                </p>
             </div>
        );
    }
    
    // ã‚²ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã®è¡¨ç¤º
    return (
        <div className="flex items-center space-x-3">
            {!isEditing ? (
                <>
                    <span className="text-white text-sm font-semibold p-1 px-3 bg-[#FF7F50] rounded-full shadow-md transition duration-300 whitespace-nowrap">
                        {welcomeMessage}
                    </span>
                    <button 
                        onClick={() => {
                            setInput(userName === GUEST_NAME ? '' : userName);
                            setIsEditing(true);
                        }}
                        className="text-white text-xs hover:text-[#B0E0E6] transition duration-150"
                        title="ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å¤‰æ›´"
                    >
                        [å¤‰æ›´]
                    </button>
                </>
            ) : (
                // ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ 
                <div className="flex space-x-2 p-1 bg-white rounded-lg shadow-inner">
                    <input
                        type="text"
                        value={input}
                        onChange={(e) => setInput(e.target.value)}
                        placeholder="åå‰ã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«"
                        className="text-gray-800 text-sm p-1 border rounded focus:ring-[#FF7F50] focus:border-[#FF7F50] w-24 sm:w-32" 
                        onKeyDown={(e) => { if (e.key === 'Enter') handleSave(); }}
                    />
                    <button 
                        onClick={handleSave}
                        className="bg-[#1F3F5F] text-white text-xs px-2 sm:px-3 py-1 rounded-lg hover:bg-[#1F3F5F]/80 transition whitespace-nowrap"
                    >
                        è¨­å®š
                    </button>
                </div>
            )}
             <p className="text-white text-xs opacity-60 hidden md:block" title="Firebaseèªè¨¼ID">
                Auth ID: {userId ? userId.substring(0, 8) + '...' : 'èªè¨¼ä¸­'}
            </p>
        </div>
    );
};

// ãƒ˜ãƒƒãƒ€ãƒ¼/ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
const Header = ({ userName, setUserName, userId }) => (
  <header className="fixed top-0 left-0 right-0 z-50 bg-[#1F3F5F] bg-opacity-95 shadow-lg h-16">
    <div className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-full">
      {/* ä¿®æ­£æ¸ˆã¿: index.html -> /index.html (Vercel/ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒç”¨ãƒ‘ã‚¹) */}
      <a href="/index.html" className="flex-shrink-0 text-lg sm:text-xl font-bold text-white tracking-widest whitespace-nowrap hover:text-[#FF7F50] transition duration-150">
        SEIO <span className="text-[#FF7F50]">DIARY</span>
      </a>
      <nav className="hidden md:flex space-x-6">
        {/* ä¿®æ­£æ¸ˆã¿: ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹ãƒªãƒ³ã‚¯ã‚’è¿½åŠ  -> /index.html (Vercel/ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒç”¨ãƒ‘ã‚¹) */}
        <a href="/index.html" className="text-white hover:text-[#FF7F50] transition duration-150 font-medium">
            ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹
        </a>
        {/* ãƒ¡ãƒ‹ãƒ¥ãƒ¼é …ç›® (ãƒ€ãƒŸãƒ¼ãƒªãƒ³ã‚¯) */}
        {['Diary', 'Profile', 'Gallery', 'About'].map((item) => (
          <a key={item} href={`#${item.toLowerCase()}`} className="text-white hover:text-[#FF7F50] transition duration-150 font-medium">
            {item}
          </a>
        ))}
      </nav>
      {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼è­˜åˆ¥æƒ…å ±ã‚’è¡¨ç¤º */}
      <UserIdentification 
        userName={userName} 
        setUserName={setUserName} 
        userId={userId} 
      />
    </div>
  </header>
);

// --- [ 3.1 é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ] ---

const renderDiaryViewer = ({ currentDiary, loading, selectedDate }) => (
    <div className="w-full bg-white p-6 md:p-8 rounded-xl shadow-2xl relative transition duration-300 hover:shadow-3xl">
        
        {/* ãƒ­ãƒ¼ãƒ‰ä¸­ã®ã‚¹ãƒ”ãƒŠãƒ¼ */}
        {loading ? (
            <div className="flex items-center justify-center h-64">
                <div className="animate-spin rounded-full h-12 w-12 border-4 border-t-[#FF7F50] border-white"></div>
                <p className="ml-4 text-[#1F3F5F] font-semibold">ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ä¸­...</p>
            </div>
        ) : currentDiary ? (
            // æ—¥è¨˜ãŒå­˜åœ¨ã™ã‚‹å ´åˆ
            <div>
                <h3 className="text-xl sm:text-2xl font-bold text-[#1F3F5F] mb-3 border-b-2 border-gray-200 pb-2">
                    {currentDiary.title || "ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãªã—ï¼‰"}
                </h3>
                {currentDiary.updatedAt && (
                    <p className="text-xs text-gray-500 mb-3">
                        æœ€çµ‚æ›´æ–°: {new Date(currentDiary.updatedAt?.toDate ? currentDiary.updatedAt.toDate() : currentDiary.updatedAt).toLocaleString('ja-JP')}
                    </p>
                )}
                {/* ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è¡¨ç¤ºã—ã€æ”¹è¡Œã‚’èªè­˜ã•ã›ã‚‹ */}
                <div className="text-gray-700 leading-relaxed whitespace-pre-wrap text-sm md:text-base">
                    {currentDiary.content || "æ—¥è¨˜ã®å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"}
                </div>
                {currentDiary.mood && (
                    <p className="mt-6 text-sm text-gray-500 italic">
                        ä»Šæ—¥ã®æ°—åˆ†: {currentDiary.mood}
                    </p>
                )}
            </div>
        ) : (
            // æ—¥è¨˜ãŒå­˜åœ¨ã—ãªã„å ´åˆ
            <div className="text-center py-12">
                <p className="text-lg sm:text-xl font-bold text-gray-500 mb-2">
                    {formatDate(selectedDate)} ã®æ—¥è¨˜ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
                </p>
                {/* ä¸€äººç§°ã€Œãƒœã‚¯ã€ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */}
                <p className="text-gray-600 text-sm">
                    ãƒœã‚¯ã®æ—¥è¨˜ã¯ã€ã¾ã ãã®æ—¥ã‚’å¾…ã£ã¦ã„ã‚‹ã¿ãŸã„ã ã€‚
                </p>
            </div>
        )}
    </div>
);

// --- [ 3.2 ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ] ---

const renderDiaryEditor = ({ 
    selectedDate, handleSave, isSaving, saveMessage, 
    editorTitle, setEditorTitle, editorContent, setEditorContent, 
    editorMood, setEditorMood, setIsEditingMode, loading 
}) => {
    
    // ä¿å­˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å‹•çš„ã«æ±ºå®š
    const getMessageStyle = (message) => {
        if (message.includes('âœ…')) return 'bg-green-100 border-green-400 text-green-700';
        if (message.includes('ğŸš¨') || message.includes('ğŸ”¥')) return 'bg-red-100 border-red-400 text-red-700';
        if (message.includes('âœ¨') || message.includes('ä¿å­˜ä¸­')) return 'bg-yellow-100 border-yellow-400 text-yellow-700';
        return 'bg-blue-100 border-blue-400 text-blue-700';
    };

    return (
        <div className="w-full bg-white p-6 md:p-8 rounded-xl shadow-2xl border-4 border-pink-300 relative">
            
            <div className="flex justify-between items-center mb-4 border-b pb-2 border-pink-200">
                <h3 className="text-xl font-bold text-pink-600">
                    âœï¸ {formatDate(selectedDate)} ã®ãƒœã‚¯ã®æ—¥è¨˜ (ç·¨é›†ä¸­)
                </h3>
                {/* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ */}
                <button
                    onClick={() => setIsEditingMode(false)}
                    title="é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚‹"
                    className="px-3 py-1 text-sm rounded-lg bg-red-100 text-red-600 font-semibold hover:bg-red-200 transition whitespace-nowrap"
                >
                    Ã— ç·¨é›†ã‚’ä¸­æ­¢ã™ã‚‹
                </button>
            </div>

            {/* çŠ¶æ…‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */}
            {saveMessage && (
                <div className={`p-3 mb-4 rounded-lg border-l-4 font-medium text-sm ${getMessageStyle(saveMessage)}`}>
                    {saveMessage}
                </div>
            )}
            
            {loading && <p className="text-center text-gray-500 py-4">ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰ä¸­...</p>}
            
            {!loading && (
                <>
                    <div className="mb-3">
                        <label htmlFor="title" className="block text-sm font-medium text-gray-700 mb-1">ã‚¿ã‚¤ãƒˆãƒ«</label>
                        <input
                            id="title"
                            type="text"
                            value={editorTitle}
                            onChange={(e) => setEditorTitle(e.target.value)}
                            placeholder="ä¾‹: å¼·è±ªæ ¡ã¨ã®åˆåŒç·´ç¿’ã§å¤§é‡‘æ˜Ÿ"
                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 text-base shadow-sm"
                        />
                    </div>

                    <div className="mb-3">
                        <label htmlFor="content" className="block text-sm font-medium text-gray-700 mb-1">æ—¥è¨˜ã®å†…å®¹ (ãƒœã‚¯ã®æ°—æŒã¡ã‚’æ­£ç›´ã«æ›¸ã„ã¦ã­)</label>
                    
                        <textarea
                            id="content"
                            value={editorContent}
                            onChange={(e) => setEditorContent(e.target.value)}
                            rows="12" 
                            placeholder="ä»Šæ—¥ã®ç·´ç¿’ã§æ„è­˜ã—ãŸã“ã¨ã€æ„Ÿã˜ãŸã“ã¨ã€æ¬¡ã®ç›®æ¨™ãªã©ã‚’æ›¸ãè¾¼ã‚‚ã†..."
                            className="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 resize-y text-base shadow-sm"
                        ></textarea>
                    </div>

                    <div className="mb-4 flex flex-col sm:flex-row justify-between items-center gap-4">
                        <div className="w-full sm:w-1/3">
                            <label htmlFor="mood" className="block text-sm font-medium text-gray-700 mb-1">ä»Šæ—¥ã®æ°—åˆ†</label>
                            <select
                                id="mood"
                                value={editorMood}
                                onChange={(e) => setEditorMood(e.target.value)}
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-pink-500 focus:border-pink-500 text-base shadow-sm"
                            >
                                {['æœ€é«˜', 'æ¥½ã—ã„', 'æ™®é€š', 'ç–²ã‚ŒãŸ', 'æ‚”ã—ã„', 'ãã®ä»–'].map(m => (
                                    <option key={m} value={m}>{m}</option>
                                ))}
                            </select>
                        </div>
                        <button
                            onClick={handleSave}
                            disabled={isSaving}
                            className={`
                                w-full sm:w-auto px-6 py-3 rounded-xl font-bold text-white text-lg shadow-lg transition duration-300 whitespace-nowrap
                                ${isSaving 
                                    ? 'bg-gray-400 cursor-not-allowed' 
                                    : 'bg-pink-500 hover:bg-pink-600 active:bg-pink-700 transform hover:scale-105'}
                            `}
                        >
                            {isSaving ? 'ä¿å­˜ä¸­...' : 'ğŸ‰ ãƒœã‚¯ã®æ—¥è¨˜ã‚’å…¬é–‹ã™ã‚‹ (ä¿å­˜)'}
                        </button>
                    </div>
                </>
            )}
        </div>
    );
};


// æ—¥è¨˜ã®è¡¨ç¤ºã¨ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼UIã‚’çµ±åˆã—ãŸãƒ¡ã‚¤ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³
const DiaryCalendarSection = ({ userId, isOwner, isEditingMode, setIsEditingMode }) => {
  const today = useMemo(() => new Date(), []);
  const [selectedDate, setSelectedDate] = useState(today);
  const [currentDiary, setCurrentDiary] = useState(null);
  const [loading, setLoading] = useState(true);
  const [currentMonth, setCurrentMonth] = useState(today.getMonth());
  const [currentYear, setCurrentYear] = useState(today.getFullYear());
  
  // ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ç”¨ã®State
  const [editorTitle, setEditorTitle] = useState('');
  const [editorContent, setEditorContent] = useState('');
  const [editorMood, setEditorMood] = useState('æ™®é€š');
  const [isSaving, setIsSaving] = useState(false);
  const [saveMessage, setSaveMessage] = useState('');
  // ç·¨é›†ä¸­ã®ãƒ‡ãƒ¼ã‚¿ãŒæœªä¿å­˜ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹State (UXæ”¹å–„ã®ãŸã‚)
  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false); 

  // --- [ A. Firestoreãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ ] ---
  useEffect(() => {
    // èªè¨¼å¾…ã¡ã€ã¾ãŸã¯DBæœªåˆæœŸåŒ–ã®å ´åˆã¯æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³
    if (!db || !userId) {
        setLoading(false);
        if (isOwner) {
            setSaveMessage('èªè¨¼ã‚’å¾…ã£ã¦ã„ã¾ã™...');
        }
        return; 
    }

    setLoading(true);
    const docId = formatDate(selectedDate); 
    // ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¹: artifacts/{appId}/users/{userId}/diaries/{æ—¥ä»˜}
    const docRef = doc(db, `artifacts/${appId}/users/${userId}/diaries`, docId);

    
    const unsubscribeSnapshot = onSnapshot(docRef, (docSnap) => {
      let data = null;
      if (docSnap.exists()) {
        data = docSnap.data();
      }
      setCurrentDiary(data ? { id: docSnap.id, ...data, date: docSnap.id } : null);

      // ã‚ªãƒ¼ãƒŠãƒ¼ã®å ´åˆã€ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’æµã—è¾¼ã‚€ï¼ˆé–²è¦§ãƒ¢ãƒ¼ãƒ‰ã§ã‚‚åŒæœŸï¼‰
      if (isOwner) {
        setEditorTitle(data?.title || '');
        setEditorContent(data?.content || '');
        setEditorMood(data?.mood || 'æ™®é€š');
        setSaveMessage(data ? 'ã“ã®æ—¥è¨˜ã‚’ç·¨é›†ã§ãã¾ã™ã€‚' : 'æœªè¨˜å…¥ã§ã™ã€‚æ–°ã—ã„è¨˜äº‹ã‚’ä½œæˆã§ãã¾ã™ï¼');
        setHasUnsavedChanges(false); // ãƒ‡ãƒ¼ã‚¿åŒæœŸå¾Œã¯å¤‰æ›´ãªã—ã¨è¦‹ãªã™
      }

      setLoading(false);
    }, (error) => {
      console.error("Firestore Snapshot Error:", error);
      setLoading(false);
    });

    return () => unsubscribeSnapshot();

  }, [userId, selectedDate, isOwner]); 
  
  // ç·¨é›†å†…å®¹ã®å¤‰æ›´ã‚’ç›£è¦–ã—ã€æœªä¿å­˜ãƒ•ãƒ©ã‚°ã‚’æ›´æ–°
  useEffect(() => {
    // ç¾åœ¨ã®Firestoreãƒ‡ãƒ¼ã‚¿ã¨ã‚¨ãƒ‡ã‚£ã‚¿ã®å€¤ã‚’æ¯”è¼ƒ
    const currentTitle = currentDiary?.title || '';
    const currentContent = currentDiary?.content || '';
    const currentMood = currentDiary?.mood || 'æ™®é€š';

    const isDirty = (
        editorTitle !== currentTitle ||
        editorContent !== currentContent ||
        editorMood !== currentMood
    );
    
    // ãƒ­ãƒ¼ãƒ‰ä¸­ã§ãªã„ã€ã‹ã¤ã‚ªãƒ¼ãƒŠãƒ¼ã®å ´åˆã®ã¿ãƒ•ãƒ©ã‚°ã‚’æ›´æ–°
    if (!loading && isOwner) {
        setHasUnsavedChanges(isDirty);
    }
  }, [editorTitle, editorContent, editorMood, currentDiary, loading, isOwner]);


  // --- [ B. æ—¥è¨˜ä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯ (ã‚ªãƒ¼ãƒŠãƒ¼å°‚ç”¨) ] ---
  const handleSave = async () => {
      if (!db || !auth || !userId) {
          setSaveMessage('ğŸš¨ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ã€ã¾ãŸã¯æœªèªè¨¼ã§ã™ã€‚');
          return;
      }
      if (!editorTitle.trim() && !editorContent.trim()) {
          setSaveMessage('ğŸš¨ ã‚¿ã‚¤ãƒˆãƒ«ã‹å†…å®¹ã®ã©ã¡ã‚‰ã‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
          return;
      }

      setIsSaving(true);
      setSaveMessage('âœ¨ ä¿å­˜ä¸­... ã‚µãƒ¼ãƒãƒ¼ã¸ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¦ã„ã¾ã™ã€‚');

      const docId = formatDate(selectedDate);
      const docRef = doc(db, `artifacts/${appId}/users/${userId}/diaries`, docId);
      
      try {
          // setDoc with merge: trueã§ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä¸Šæ›¸ãã¾ãŸã¯æ–°è¦ä½œæˆ
          await setDoc(docRef, {
              title: editorTitle,
              content: editorContent,
              mood: editorMood,
              updatedAt: new Date(),
              createdAt: currentDiary?.createdAt || new Date(), 
          }, { merge: true }); 

          setSaveMessage('âœ… ãƒœã‚¯ã®æ—¥è¨˜ã®ä¿å­˜ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
          setHasUnsavedChanges(false); // ä¿å­˜å®Œäº†
          // ä¿å­˜æˆåŠŸå¾Œã€è‡ªå‹•çš„ã«é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚‹
          setIsEditingMode(false); 
      } catch (error) {
          console.error("Firestore Save Error:", error);
          setSaveMessage(`ğŸ”¥ ä¿å­˜å¤±æ•—: ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ ${error.code}ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚`);
      } finally {
          setIsSaving(false);
      }
  };
  
  // æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚‹å ´åˆã®ç¢ºèªãƒãƒ³ãƒ‰ãƒ©
  const handleUnsavedChangeCheck = (callback) => {
      if (isOwner && isEditingMode && hasUnsavedChanges) {
          // ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ä»£ã‚ã‚Šã«ã€ä¸€æ™‚çš„ãªUIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªã‚’ä¿ƒã™
          setSaveMessage('ğŸš¨ æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™ï¼ä¸­æ­¢ãƒœã‚¿ãƒ³ã§ç ´æ£„ã™ã‚‹ã‹ã€ä¿å­˜ãƒœã‚¿ãƒ³ã§ä¿å­˜ã—ã¦ãã ã•ã„ã€‚');
          // å¤‰æ›´ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸã“ã¨ã‚’ä¼ãˆã‚‹ãŸã‚ã€falseã‚’è¿”ã™ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ“ä½œã‚’ä¸­æ­¢ï¼‰
          return false; 
      }
      // å¤‰æ›´ãŒãªã„ã€ã¾ãŸã¯ã‚²ã‚¹ãƒˆã®å ´åˆã¯ãã®ã¾ã¾å®Ÿè¡Œ
      callback();
      // å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã¯ã™ã§ã«falseãŒè¿”ã£ã¦ã„ã‚‹ã®ã§ã€æˆåŠŸæ™‚ã¯trueã‚’è¿”ã™ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ“ä½œã‚’å®Ÿè¡Œï¼‰
      return true;
  };


  // --- [ C. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼UIãƒ­ã‚¸ãƒƒã‚¯ ] ---
  
  const getFirstDayOfMonth = (year, month) => new Date(year, month, 1);
  const getLastDayOfMonth = (year, month) => new Date(year, month + 1, 0);

  const daysInMonth = useMemo(() => {
    // ... ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯å¤‰æ›´ãªã—
    const startDay = getFirstDayOfMonth(currentYear, currentMonth);
    const endDay = getLastDayOfMonth(currentYear, currentMonth);
    const numDays = endDay.getDate();
    
    const days = [];
    const startWeekDay = startDay.getDay(); 
    const startOffset = startWeekDay;
    
    const prevMonth = currentMonth === 0 ? 11 : currentMonth - 1;
    const prevYear = currentMonth === 0 ? currentYear - 1 : currentYear;
    const lastDayOfPrevMonth = getLastDayOfMonth(prevYear, prevMonth).getDate();

    for (let i = startOffset; i > 0; i--) {
        days.push({ 
            date: new Date(prevYear, prevMonth, lastDayOfPrevMonth - i + 1), 
            isCurrentMonth: false 
        });
    }

    for (let i = 1; i <= numDays; i++) {
        days.push({ 
            date: new Date(currentYear, currentMonth, i), 
            isCurrentMonth: true 
        });
    }

    const totalSlots = 42; 
    const nextMonth = currentMonth === 11 ? 0 : currentMonth + 1;
    const nextYear = currentMonth === 11 ? currentYear + 1 : currentYear;
    
    for (let i = 1; days.length < totalSlots; i++) {
        days.push({ 
            date: new Date(nextYear, nextMonth, i), 
            isCurrentMonth: false 
        });
    }

    return days;
  }, [currentYear, currentMonth]);

  const handleYearChange = (e) => {
    // æœªä¿å­˜ã®å¤‰æ›´ãƒã‚§ãƒƒã‚¯
    handleUnsavedChangeCheck(() => {
        const newYear = parseInt(e.target.value, 10);
        const newMonth = currentMonth; 
    
        setCurrentYear(newYear);
        const day = Math.min(selectedDate.getDate(), getLastDayOfMonth(newYear, newMonth).getDate());
        const newSelectedDate = new Date(newYear, newMonth, day);
        setSelectedDate(newSelectedDate);
        if (isOwner) setIsEditingMode(false);
    });
  };
  
  const changeMonth = (delta) => {
    // æœªä¿å­˜ã®å¤‰æ›´ãƒã‚§ãƒƒã‚¯
    handleUnsavedChangeCheck(() => {
        const newDate = new Date(currentYear, currentMonth + delta, 1);
        const newYear = newDate.getFullYear();
        const newMonth = newDate.getMonth(); 
    
        setCurrentYear(newYear);
        setCurrentMonth(newMonth);
        
        const day = Math.min(selectedDate.getDate(), getLastDayOfMonth(newYear, newMonth).getDate());
        const newSelectedDate = new Date(newYear, newMonth, day);
        setSelectedDate(newSelectedDate); 
        if (isOwner) setIsEditingMode(false);
    });
  };

  const handleDayClick = (date) => {
    // æœªä¿å­˜ã®å¤‰æ›´ãƒã‚§ãƒƒã‚¯
    // åˆ¥ã®æœˆã®æ—¥ä»˜ã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚åå¿œã—ãªã„ï¼ˆã“ã“ã§ã¯ç„¡åŠ¹åŒ–ï¼‰
    if (!date.isCurrentMonth) {
        // ã‚‚ã—åˆ¥ã®æœˆã®æ—¥ã®ã‚¯ãƒªãƒƒã‚¯ã‚’è¨±å¯ã™ã‚‹ãªã‚‰ã€ã“ã“ã§æœˆã‚’å¤‰æ›´ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹
        // changeMonth(date.date.getTime() > selectedDate.getTime() ? 1 : -1);
        return; 
    }
    
    handleUnsavedChangeCheck(() => {
        setSelectedDate(date.date);
        // ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ—¥ãŒã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®è¡¨ç¤ºæœˆã¨ç•°ãªã£ã¦ã„ã‚Œã°ã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚‚ç§»å‹•ã•ã›ã‚‹
        if (date.date.getMonth() !== currentMonth || date.date.getFullYear() !== currentYear) {
            setCurrentMonth(date.date.getMonth());
            setCurrentYear(date.date.getFullYear());
        }
        if (isOwner) setIsEditingMode(false);
    });
  };
  
  // --- [ D. ãƒ¡ã‚¤ãƒ³ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ] ---

  const isToday = (date) => formatDate(date) === formatDate(today);
  const isSelected = (date) => formatDate(date) === formatDate(selectedDate);
  
  const currentMonthName = new Intl.DateTimeFormat('ja-JP', { month: 'long' }).format(getFirstDayOfMonth(currentYear, currentMonth));

  return (
    <section id="diary" className="min-h-screen pb-20 lg:pb-10 px-3 md:px-6" style={{ backgroundColor: COLORS.main }}> 
      <div className="max-w-5xl mx-auto"> 
        <h2 className="text-3xl md:text-4xl font-extrabold text-[#1F3F5F] mb-8 border-b-4 border-[#FF7F50] pb-2 inline-block pt-8 lg:pt-0">
            {formatDate(selectedDate).replace(/-/g, '.')} ã®æ—¥è¨˜
        </h2>
        
        <div className="mb-6 flex justify-end items-center space-x-4">
            <label htmlFor="year-select" className="text-base font-medium text-[#1F3F5F]">å¹´é¸æŠ:</label>
            <select
                id="year-select"
                value={currentYear}
                onChange={handleYearChange}
                className="p-2 border border-gray-300 rounded-lg shadow-md focus:ring-[#FF7F50] focus:border-[#FF7F50] transition text-sm"
            >
                {YEAR_OPTIONS.map(option => (
                    <option key={option.value} value={option.value}>{option.label}</option>
                ))}
            </select>
        </div>


        <div className="flex flex-col lg:flex-row gap-8">
          
          {/* æ—¥è¨˜ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ (å·¦å´) - ã‚ªãƒ¼ãƒŠãƒ¼ã¯ãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆ */}
          {isOwner && isEditingMode 
            ? renderDiaryEditor({
                selectedDate, 
                handleSave, 
                isSaving, 
                saveMessage, 
                editorTitle, 
                setEditorTitle, 
                editorContent, 
                setEditorContent, 
                editorMood, 
                setEditorMood, 
                setIsEditingMode, 
                loading 
            }) 
            : (
                <div className="relative lg:w-2/3">
                    {renderDiaryViewer({
                        currentDiary,
                        loading,
                        selectedDate,
                    })}
                    
                    {/* ã€PC/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå‘ã‘ã®ç·¨é›†ãƒœã‚¿ãƒ³ã€‘: lgã‚µã‚¤ã‚ºä»¥ä¸Šã§è¡¨ç¤º */}
                    {isOwner && !isEditingMode && (
                        <button
                            onClick={() => setIsEditingMode(true)}
                            className={`hidden lg:block absolute top-5 right-5 px-4 py-2 text-sm rounded-xl font-bold text-white transition duration-200 shadow-lg`}
                            style={{ backgroundColor: COLORS.accent }} // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã§è‰²ã‚’ç¢ºå®š
                            title={`ã€${formatDate(selectedDate)}ã€ã®æ—¥è¨˜ã‚’ç·¨é›†/ä½œæˆ`}
                        >
                            <svg className="w-4 h-4 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.862 4.487z" /></svg>
                            æ—¥è¨˜ã‚’ç·¨é›†ã™ã‚‹
                        </button>
                    )}
                </div>
            )}
          
          {/* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼UI (å³å´) */}
          <div className="lg:w-1/3 bg-white p-5 rounded-xl shadow-2xl">
            <div className="flex justify-between items-center mb-5">
              <button 
                onClick={() => changeMonth(-1)}
                className="p-1 rounded-full hover:bg-gray-100 transition text-[#1F3F5F]"
                title="å‰æœˆã¸"
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5">
                    <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                </svg>
              </button>
              <h3 className="text-xl font-bold text-[#1F3F5F] tracking-wider">
                {currentYear}å¹´ {currentMonthName}
              </h3>
              <button 
                onClick={() => changeMonth(1)}
                className="p-1 rounded-full hover:bg-gray-100 transition text-[#1F3F5F]"
                title="æ¬¡æœˆã¸"
              >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5">
                    <path strokeLinecap="round" strokeLinejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                </svg>
              </button>
            </div>
            
            <div className="grid grid-cols-7 text-center text-xs font-semibold text-gray-500 mb-1">
              <span className="text-red-500">æ—¥</span>
              <span>æœˆ</span>
              <span>ç«</span>
              <span>æ°´</span>
              <span>æœ¨</span>
              <span>é‡‘</span>
              <span className="text-blue-500">åœŸ</span>
            </div>
            
            <div className="grid grid-cols-7 gap-1">
              {daysInMonth.map((day, index) => {
                const dayDate = day.date;
                const isCurrent = day.isCurrentMonth;
                const isDaySelected = isSelected(dayDate);
                const isDayToday = isToday(dayDate);
                
                let textColor = isCurrent ? COLORS.dark : 'text-gray-400';
                if (dayDate.getDay() === 0) textColor = isCurrent ? 'text-red-500' : 'text-red-300'; 
                if (dayDate.getDay() === 6) textColor = isCurrent ? 'text-blue-500' : 'text-blue-300'; 

                return (
                  <div
                    key={index}
                    onClick={() => handleDayClick(dayDate)}
                    className={`
                      w-full h-8 flex items-center justify-center rounded-full
                      font-medium transition duration-150 relative text-xs
                      ${textColor} 
                      ${isCurrent ? 'cursor-pointer hover:bg-gray-100' : 'cursor-default opacity-50'}
                      ${isDaySelected ? 'bg-[#FF7F50] text-white hover:bg-[#FF7F50]/90 shadow-md' : ''}
                      ${isDayToday && !isDaySelected ? 'border-2 border-dashed border-[#1F3F5F]/50' : ''}
                    `}
                    title={isCurrent ? `${formatDate(dayDate)}ã®æ—¥è¨˜ã‚’é¸æŠ` : 'åˆ¥æœˆã®æ—¥ä»˜'}
                  >
                    {dayDate.getDate()}
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      </div>
      {/* ã€ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ã®ç·¨é›†ãƒœã‚¿ãƒ³ã€‘: lgã‚µã‚¤ã‚ºä»¥ä¸Šã§éè¡¨ç¤º (lg:hidden) */}
      {isOwner && (
          <div className="fixed bottom-0 left-0 right-0 z-40 p-4 bg-white/95 shadow-[0_-5px_15px_rgba(0,0,0,0.1)] backdrop-blur-sm lg:hidden">
            <button
                onClick={() => {
                    // æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯ã€é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã¸ã®åˆ‡ã‚Šæ›¿ãˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹
                    if (isEditingMode && hasUnsavedChanges) {
                        setSaveMessage('ğŸš¨ æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™ï¼ä¸­æ­¢ãƒœã‚¿ãƒ³ã§ç ´æ£„ã™ã‚‹ã‹ã€ä¿å­˜ãƒœã‚¿ãƒ³ã§ä¿å­˜ã—ã¦ãã ã•ã„ã€‚');
                        return;
                    }
                    setIsEditingMode(prev => !prev);
                }}
                title={isEditingMode ? 'é–²è¦§ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚‹' : `ã€${formatDate(selectedDate)}ã€ã®æ—¥è¨˜ã‚’ç·¨é›†/ä½œæˆ`}
                className={`
                    w-full text-white font-bold px-6 py-3 rounded-xl transition duration-200 shadow-xl 
                    flex items-center justify-center text-lg whitespace-nowrap
                    ${isEditingMode 
                        // ç·¨é›†ä¸­ã¯èµ¤ç³»ã§å±é™ºè‰²ã‚’ã‚¢ãƒ”ãƒ¼ãƒ«
                        ? 'bg-red-500 hover:bg-red-600 active:bg-red-700 transform scale-[0.98]' 
                        // é€šå¸¸æ™‚ã¯ç›®ç«‹ã¤ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼
                        : `hover:bg-[${COLORS.accent}]/90 active:bg-[${COLORS.accent}]/80 transform hover:scale-[1.01]`}
                `}
                style={{ backgroundColor: isEditingMode ? '#EF4444' : COLORS.accent }} // Tailwind JIT compilation bug workaround
            >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2.5} stroke="currentColor" className="w-5 h-5 mr-3">
                    <path strokeLinecap="round" strokeLinejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.862 4.487Z" />
                </svg>
                {isEditingMode ? 'ç·¨é›†ä¸­: é–²è¦§ã«æˆ»ã‚‹' : 'æ—¥è¨˜ã‚’æ›¸ã/ç·¨é›†ã™ã‚‹'}
            </button>
            <p className="text-center text-xs text-gray-500 mt-1">
                {isEditingMode ? 'â€» æ—¥è¨˜ã®å†…å®¹ã‚’ä¿å­˜ã™ã‚‹ã«ã¯ãƒ•ã‚©ãƒ¼ãƒ å†…ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚' : `é¸æŠæ—¥: ${formatDate(selectedDate)}`}
            </p>
          </div>
      )}
    </section>
  );
};


// HeroSectionã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
const HeroSection = () => {
    // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”»åƒ
    const ASUKA_IMAGE_URL = "
